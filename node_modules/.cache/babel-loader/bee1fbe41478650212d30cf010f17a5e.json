{"ast":null,"code":"import _classCallCheck from \"/Users/jenniferhe/Documents/GitHub/oval/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/jenniferhe/Documents/GitHub/oval/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { alloc, concat, slice } from './byte-utils.js';\nvar defaultChunkSize = 256;\nexport var Bl = /*#__PURE__*/function () {\n  function Bl() {\n    var chunkSize = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : defaultChunkSize;\n\n    _classCallCheck(this, Bl);\n\n    this.chunkSize = chunkSize;\n    this.cursor = 0;\n    this.maxCursor = -1;\n    this.chunks = [];\n    this._initReuseChunk = null;\n  }\n\n  _createClass(Bl, [{\n    key: \"reset\",\n    value: function reset() {\n      this.chunks = [];\n      this.cursor = 0;\n      this.maxCursor = -1;\n\n      if (this._initReuseChunk !== null) {\n        this.chunks.push(this._initReuseChunk);\n        this.maxCursor = this._initReuseChunk.length - 1;\n      }\n    }\n  }, {\n    key: \"push\",\n    value: function push(bytes) {\n      var topChunk = this.chunks[this.chunks.length - 1];\n      var newMax = this.cursor + bytes.length;\n\n      if (newMax <= this.maxCursor + 1) {\n        var chunkPos = topChunk.length - (this.maxCursor - this.cursor) - 1;\n        topChunk.set(bytes, chunkPos);\n      } else {\n        if (topChunk) {\n          var _chunkPos = topChunk.length - (this.maxCursor - this.cursor) - 1;\n\n          if (_chunkPos < topChunk.length) {\n            this.chunks[this.chunks.length - 1] = topChunk.subarray(0, _chunkPos);\n            this.maxCursor = this.cursor - 1;\n          }\n        }\n\n        if (bytes.length < 64 && bytes.length < this.chunkSize) {\n          topChunk = alloc(this.chunkSize);\n          this.chunks.push(topChunk);\n          this.maxCursor += topChunk.length;\n\n          if (this._initReuseChunk === null) {\n            this._initReuseChunk = topChunk;\n          }\n\n          topChunk.set(bytes, 0);\n        } else {\n          this.chunks.push(bytes);\n          this.maxCursor += bytes.length;\n        }\n      }\n\n      this.cursor += bytes.length;\n    }\n  }, {\n    key: \"toBytes\",\n    value: function toBytes() {\n      var reset = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      var byts;\n\n      if (this.chunks.length === 1) {\n        var chunk = this.chunks[0];\n\n        if (reset && this.cursor > chunk.length / 2) {\n          byts = this.cursor === chunk.length ? chunk : chunk.subarray(0, this.cursor);\n          this._initReuseChunk = null;\n          this.chunks = [];\n        } else {\n          byts = slice(chunk, 0, this.cursor);\n        }\n      } else {\n        byts = concat(this.chunks, this.cursor);\n      }\n\n      if (reset) {\n        this.reset();\n      }\n\n      return byts;\n    }\n  }]);\n\n  return Bl;\n}();","map":{"version":3,"sources":["/Users/jenniferhe/Documents/GitHub/oval/node_modules/cborg/esm/lib/bl.js"],"names":["alloc","concat","slice","defaultChunkSize","Bl","chunkSize","cursor","maxCursor","chunks","_initReuseChunk","push","length","bytes","topChunk","newMax","chunkPos","set","subarray","reset","byts","chunk"],"mappings":";;AAAA,SACEA,KADF,EAEEC,MAFF,EAGEC,KAHF,QAIO,iBAJP;AAKA,IAAMC,gBAAgB,GAAG,GAAzB;AACA,WAAaC,EAAb;AACE,gBAA0C;AAAA,QAA9BC,SAA8B,uEAAlBF,gBAAkB;;AAAA;;AACxC,SAAKE,SAAL,GAAiBA,SAAjB;AACA,SAAKC,MAAL,GAAc,CAAd;AACA,SAAKC,SAAL,GAAiB,CAAC,CAAlB;AACA,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,eAAL,GAAuB,IAAvB;AACD;;AAPH;AAAA;AAAA,WAQE,iBAAQ;AACN,WAAKD,MAAL,GAAc,EAAd;AACA,WAAKF,MAAL,GAAc,CAAd;AACA,WAAKC,SAAL,GAAiB,CAAC,CAAlB;;AACA,UAAI,KAAKE,eAAL,KAAyB,IAA7B,EAAmC;AACjC,aAAKD,MAAL,CAAYE,IAAZ,CAAiB,KAAKD,eAAtB;AACA,aAAKF,SAAL,GAAiB,KAAKE,eAAL,CAAqBE,MAArB,GAA8B,CAA/C;AACD;AACF;AAhBH;AAAA;AAAA,WAiBE,cAAKC,KAAL,EAAY;AACV,UAAIC,QAAQ,GAAG,KAAKL,MAAL,CAAY,KAAKA,MAAL,CAAYG,MAAZ,GAAqB,CAAjC,CAAf;AACA,UAAMG,MAAM,GAAG,KAAKR,MAAL,GAAcM,KAAK,CAACD,MAAnC;;AACA,UAAIG,MAAM,IAAI,KAAKP,SAAL,GAAiB,CAA/B,EAAkC;AAChC,YAAMQ,QAAQ,GAAGF,QAAQ,CAACF,MAAT,IAAmB,KAAKJ,SAAL,GAAiB,KAAKD,MAAzC,IAAmD,CAApE;AACAO,QAAAA,QAAQ,CAACG,GAAT,CAAaJ,KAAb,EAAoBG,QAApB;AACD,OAHD,MAGO;AACL,YAAIF,QAAJ,EAAc;AACZ,cAAME,SAAQ,GAAGF,QAAQ,CAACF,MAAT,IAAmB,KAAKJ,SAAL,GAAiB,KAAKD,MAAzC,IAAmD,CAApE;;AACA,cAAIS,SAAQ,GAAGF,QAAQ,CAACF,MAAxB,EAAgC;AAC9B,iBAAKH,MAAL,CAAY,KAAKA,MAAL,CAAYG,MAAZ,GAAqB,CAAjC,IAAsCE,QAAQ,CAACI,QAAT,CAAkB,CAAlB,EAAqBF,SAArB,CAAtC;AACA,iBAAKR,SAAL,GAAiB,KAAKD,MAAL,GAAc,CAA/B;AACD;AACF;;AACD,YAAIM,KAAK,CAACD,MAAN,GAAe,EAAf,IAAqBC,KAAK,CAACD,MAAN,GAAe,KAAKN,SAA7C,EAAwD;AACtDQ,UAAAA,QAAQ,GAAGb,KAAK,CAAC,KAAKK,SAAN,CAAhB;AACA,eAAKG,MAAL,CAAYE,IAAZ,CAAiBG,QAAjB;AACA,eAAKN,SAAL,IAAkBM,QAAQ,CAACF,MAA3B;;AACA,cAAI,KAAKF,eAAL,KAAyB,IAA7B,EAAmC;AACjC,iBAAKA,eAAL,GAAuBI,QAAvB;AACD;;AACDA,UAAAA,QAAQ,CAACG,GAAT,CAAaJ,KAAb,EAAoB,CAApB;AACD,SARD,MAQO;AACL,eAAKJ,MAAL,CAAYE,IAAZ,CAAiBE,KAAjB;AACA,eAAKL,SAAL,IAAkBK,KAAK,CAACD,MAAxB;AACD;AACF;;AACD,WAAKL,MAAL,IAAeM,KAAK,CAACD,MAArB;AACD;AA7CH;AAAA;AAAA,WA8CE,mBAAuB;AAAA,UAAfO,KAAe,uEAAP,KAAO;AACrB,UAAIC,IAAJ;;AACA,UAAI,KAAKX,MAAL,CAAYG,MAAZ,KAAuB,CAA3B,EAA8B;AAC5B,YAAMS,KAAK,GAAG,KAAKZ,MAAL,CAAY,CAAZ,CAAd;;AACA,YAAIU,KAAK,IAAI,KAAKZ,MAAL,GAAcc,KAAK,CAACT,MAAN,GAAe,CAA1C,EAA6C;AAC3CQ,UAAAA,IAAI,GAAG,KAAKb,MAAL,KAAgBc,KAAK,CAACT,MAAtB,GAA+BS,KAA/B,GAAuCA,KAAK,CAACH,QAAN,CAAe,CAAf,EAAkB,KAAKX,MAAvB,CAA9C;AACA,eAAKG,eAAL,GAAuB,IAAvB;AACA,eAAKD,MAAL,GAAc,EAAd;AACD,SAJD,MAIO;AACLW,UAAAA,IAAI,GAAGjB,KAAK,CAACkB,KAAD,EAAQ,CAAR,EAAW,KAAKd,MAAhB,CAAZ;AACD;AACF,OATD,MASO;AACLa,QAAAA,IAAI,GAAGlB,MAAM,CAAC,KAAKO,MAAN,EAAc,KAAKF,MAAnB,CAAb;AACD;;AACD,UAAIY,KAAJ,EAAW;AACT,aAAKA,KAAL;AACD;;AACD,aAAOC,IAAP;AACD;AAhEH;;AAAA;AAAA","sourcesContent":["import {\n  alloc,\n  concat,\n  slice\n} from './byte-utils.js';\nconst defaultChunkSize = 256;\nexport class Bl {\n  constructor(chunkSize = defaultChunkSize) {\n    this.chunkSize = chunkSize;\n    this.cursor = 0;\n    this.maxCursor = -1;\n    this.chunks = [];\n    this._initReuseChunk = null;\n  }\n  reset() {\n    this.chunks = [];\n    this.cursor = 0;\n    this.maxCursor = -1;\n    if (this._initReuseChunk !== null) {\n      this.chunks.push(this._initReuseChunk);\n      this.maxCursor = this._initReuseChunk.length - 1;\n    }\n  }\n  push(bytes) {\n    let topChunk = this.chunks[this.chunks.length - 1];\n    const newMax = this.cursor + bytes.length;\n    if (newMax <= this.maxCursor + 1) {\n      const chunkPos = topChunk.length - (this.maxCursor - this.cursor) - 1;\n      topChunk.set(bytes, chunkPos);\n    } else {\n      if (topChunk) {\n        const chunkPos = topChunk.length - (this.maxCursor - this.cursor) - 1;\n        if (chunkPos < topChunk.length) {\n          this.chunks[this.chunks.length - 1] = topChunk.subarray(0, chunkPos);\n          this.maxCursor = this.cursor - 1;\n        }\n      }\n      if (bytes.length < 64 && bytes.length < this.chunkSize) {\n        topChunk = alloc(this.chunkSize);\n        this.chunks.push(topChunk);\n        this.maxCursor += topChunk.length;\n        if (this._initReuseChunk === null) {\n          this._initReuseChunk = topChunk;\n        }\n        topChunk.set(bytes, 0);\n      } else {\n        this.chunks.push(bytes);\n        this.maxCursor += bytes.length;\n      }\n    }\n    this.cursor += bytes.length;\n  }\n  toBytes(reset = false) {\n    let byts;\n    if (this.chunks.length === 1) {\n      const chunk = this.chunks[0];\n      if (reset && this.cursor > chunk.length / 2) {\n        byts = this.cursor === chunk.length ? chunk : chunk.subarray(0, this.cursor);\n        this._initReuseChunk = null;\n        this.chunks = [];\n      } else {\n        byts = slice(chunk, 0, this.cursor);\n      }\n    } else {\n      byts = concat(this.chunks, this.cursor);\n    }\n    if (reset) {\n      this.reset();\n    }\n    return byts;\n  }\n}"]},"metadata":{},"sourceType":"module"}